<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Sapporo Industrial VFD v131.26</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000;
            --iron-panel: #060608;
            --led-dim-grad: linear-gradient(180deg, #1a1a1c 0%, #080809 100%);
            --glow-core: #ffffff;
            --glow-main: #ff9d00; 
            --glow-outer: #ff3300;
            --discharge: 0 0 10px var(--glow-core), 0 0 20px var(--glow-main), 0 0 3<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Sapporo Industrial VFD v131.27</title>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000;
            --iron-panel: #060608;
            --led-dim-grad: linear-gradient(180deg, #1a1a1c 0%, #080809 100%);
            --glow-core: #ffffff;
            --glow-main: #ff9d00; 
            --glow-outer: #ff3300;
            --discharge: 0 0 10px var(--glow-core), 0 0 20px var(--glow-main), 0 0 35px var(--glow-outer), 0 0 50px rgba(255, 34, 0, 0.4);
            --header-font-size: 3.3vh; 
            --base-ui-size: 2.3vh;
            --border-main: 2px solid #333;
            --section-gap: 7.6px solid #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-weight: normal !important; }
        body { background-color: var(--bg-color); width: 100vw; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'DotGothic16', sans-serif; color: #fff; }

        .bezel { background: var(--iron-panel); box-shadow: inset 0 0 40px #000; margin: 4px; position: relative; flex-shrink: 0; }
        .digit { position: relative; flex-shrink: 0; margin-right: 1.2vw; } 
        .seg { position: absolute; background: var(--led-dim-grad); border-radius: 1px; }
        .seg-h { width: 74%; height: 10%; left: 13%; } .seg-v { width: 15%; height: 38%; } 
        .seg-a { top: 2%; } .seg-b { top: 6%; right: 2%; } .seg-c { bottom: 6%; right: 2%; }
        .seg-d { bottom: 2%; } .seg-e { bottom: 6%; left: 2%; } .seg-f { top: 6%; left: 2%; }
        .seg-g { top: 45%; width: 64%; height: 10%; left: 18%; } 
        .on { background: var(--glow-core) !important; box-shadow: var(--discharge); z-index: 2; }
        .dot-unit { background: var(--led-dim-grad); border-radius: 50%; }

        /* TOP SECTION */
        #top-section { height: 40vh; display: flex; align-items: center; justify-content: center; border: 4px solid #151515; }
        .clock-wrapper { display: flex; align-items: flex-end; transform: scale(0.86); } 
        .d-lg { width: 13.9vw; height: 32vh; } .d-sm { width: 3.63vw; height: 12vh; }  
        .dot-date { width: 0.7vw; height: 0.7vw; margin-bottom: 0.5vh; margin-right: 1.2vw; } 
        .dot-time { width: 2.1vw; height: 2.1vw; } 
        .colon-box { display: flex; flex-direction: column; gap: 7vh; margin-bottom: 5vh; padding: 0 1.2vw; }

        /* MID SECTION - AMEDAS INTEGRATED HEADER */
        #mid-section { height: 46vh; display: flex; flex-direction: column; border-top: var(--section-gap); border-bottom: var(--section-gap); margin: 0 4px; }
        .h-row-unified { display: flex; height: 8vh; background: #000; border-bottom: var(--border-main); flex-shrink: 0; }
        .h-side { width: 20%; font-size: 2.8vh; display: flex; align-items: center; justify-content: center; letter-spacing: 2px; color: #666; }
        .h-center { width: 60%; border-left: var(--border-main); border-right: var(--border-main); background: #0a0a0a; display: flex; align-items: center; justify-content: space-around; padding: 0 1vw; }
        
        .amedas-header-box { display: flex; align-items: center; gap: 0.8vw; }
        .amedas-label { font-size: 1.8vh; color: var(--glow-main); text-shadow: 0 0 10px var(--glow-outer); }
        .amedas-unit { font-size: 1.6vh; color: #555; }
        .d-upd { width: 1.8vw; height: 3.8vh; margin-right: 0.4vw !important; }

        /* WEATHER AREA */
        .weather-grid { display: grid; grid-template-columns: 1fr 1fr; flex-grow: 1; }
        .card { border-right: var(--border-main); display: flex; flex-direction: column; height: 100%; justify-content: center; }
        .card:last-child { border-right: none; }
        
        .w-main-row { display: flex; align-items: center; height: 100%; }
        .w-visual { width: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #222; height: 80%; }
        .w-icon { font-size: 8vh; margin-bottom: 2vh; text-shadow: 0 0 15px var(--glow-main); color: transparent; text-shadow: 0 0 0 white, 0 0 15px var(--glow-main); }
        .w-text { font-size: 2.2vh; text-align: center; color: #fff; padding: 0 1vw; }
        .w-stats { width: 50%; display: flex; flex-direction: column; gap: 3vh; align-items: flex-end; padding-right: 2vw; }
        
        .temp-line { display: flex; align-items: center; }
        .label-box { font-size: 2vh; padding: 4px 8px; min-width: 5vw; text-align: center; border-radius: 2px; margin-right: 1.2vw; }
        .hi-label { color: #000; background: var(--glow-main); box-shadow: 0 0 10px var(--glow-outer); } 
        .lo-label { color: #000; background: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5); } 
        .d-temp { width: 3.2vw; height: 9vh; }

        /* ADMIN */
        #admin { position: fixed; bottom: 20px; right: 20px; z-index: 100; opacity: 0.05; transition: 0.4s; }
        #admin:hover { opacity: 1; }
        #admin button { background: #000; color: var(--glow-main); border: 1px solid var(--glow-main); padding: 5px 10px; font-family: 'DotGothic16'; cursor: pointer; font-size: 12px; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        #editor { background: #111; border: 2px solid #444; padding: 20px; width: 400px; }
        input { background: #000; border: 1px solid #333; color: #fff; padding: 10px; width: 100%; margin-bottom: 15px; font-family: 'DotGothic16'; }

        /* BOTTOM */
        #bot-section { height: 12vh; display: flex; align-items: center; border: 4px solid #151515; overflow: hidden; position: relative; }
        .ticker { white-space: nowrap; font-size: 6vh; color: var(--glow-main); line-height: 12vh; text-shadow: 0 0 15px var(--glow-outer); position: absolute; }
        @keyframes ticker-anim { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }
    </style>
</head>
<body>

    <div id="top-section" class="bezel">
        <div class="clock-wrapper">
            <div id="date-group" style="display:flex; align-items:flex-end; padding-right:2.0vw;"></div>
            <div id="time-group" style="display:flex; align-items:flex-end;"></div>
            <div id="sec-group" style="display:flex; align-items:flex-end; margin-left:1.5vw;"></div>
        </div>
    </div>

    <div id="mid-section" class="bezel">
        <div class="h-row-unified">
            <div class="h-side">TODAY</div>
            <div class="h-center">
                <div class="amedas-header-box">
                    <span class="amedas-label">AMeDAS TEMP</span>
                    <div id="am-t-header" style="display:flex;"></div>
                    <span class="amedas-unit">℃</span>
                </div>
                <div class="amedas-header-box">
                    <span class="amedas-label">WIND</span>
                    <div id="am-w-header" style="display:flex;"></div>
                    <span class="amedas-unit">m/s</span>
                </div>
            </div>
            <div class="h-side">TOMORROW</div>
        </div>
        <div class="weather-grid" id="weatherGrid"></div>
    </div>

    <div id="bot-section" class="bezel"><div class="ticker" id="ticker-text"></div></div>

    <div id="admin"><button onclick="document.getElementById('overlay').style.display='flex'">EDIT</button></div>
    <div id="overlay">
        <div id="editor">
            <input type="text" id="msg-input" placeholder="TICKER MESSAGE...">
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="document.getElementById('overlay').style.display='none'">CANCEL</button>
                <button onclick="saveMsg()" style="background:var(--glow-main); color:black;">SAVE</button>
            </div>
        </div>
    </div>

    <script>
        const MAP = {'0':[1,1,1,1,1,1,0],'1':[0,1,1,0,0,0,0],'2':[1,1,0,1,1,0,1],'3':[1,1,1,1,0,0,1],'4':[0,1,1,0,0,1,1],'5':[1,0,1,1,0,1,1],'6':[1,0,1,1,1,1,1],'7':[1,1,1,0,0,0,0],'8':[1,1,1,1,1,1,1],'9':[1,1,1,1,0,1,1],'-':[0,0,0,0,0,0,1],' ':[0,0,0,0,0,0,0]};
        function build(cls) { return `<div class="digit ${cls}">${['a','b','c','d','e','f','g'].map(s=>`<div class="seg seg-${s} ${['a','d','g'].includes(s)?'seg-h':'seg-v'}"></div>`).join('')}</div>`; }
        function draw(parent, str) {
            if (!parent) return;
            const ds = parent.querySelectorAll('.digit');
            const ts = String(str).padStart(ds.length, ' ');
            for(let i=0; i<ds.length; i++) {
                const pat = MAP[ts[i]] || MAP[' '];
                ds[i].querySelectorAll('.seg').forEach((s, idx) => s.classList.toggle('on', !!pat[idx]));
            }
        }

        async function updateAll() {
            try {
                const fRes = await fetch("https://www.jma.go.jp/bosai/forecast/data/forecast/016000.json");
                const fData = await fRes.json();
                const tRes = await fetch("https://www.jma.go.jp/bosai/amedas/data/latest_time.txt");
                const tStr = await tRes.text();
                const aKey = tStr.replace(/[-T:Z+]/g, '').substring(0, 12) + "00";
                const aRes = await fetch(`https://www.jma.go.jp/bosai/amedas/data/map/${aKey}.json`);
                const aData = await aRes.json();
                const sap = aData["14163"];

                const grid = document.getElementById('weatherGrid');
                const temps = fData[0].timeSeries[2].areas[0].temps; // [今日HI, 今日LO, 明日HI, 明日LO] ※地域により順序変動

                let html = "";
                for(let i=0; i<2; i++){
                    const wText = fData[0].timeSeries[0].areas[0].weathers[i];
                    const icon = wText.includes('雪') ? '❄️' : wText.includes('雨') ? '☔' : wText.includes('曇') ? '☁️' : '☀️';
                    
                    // 明日のHI/LO逆転修正: 明日は temps[2]が最低, temps[3]が最高 になるケースが多いが、JMAの仕様に合わせる
                    // 多くの地点で [今日最暖, 今日最寒, 明日最寒, 明日最暖]
                    let hiVal = (i === 0) ? temps[0] : temps[3];
                    let loVal = (i === 0) ? temps[1] : temps[2];

                    html += `<div class="card"><div class="w-main-row"><div class="w-visual"><div class="w-icon">${icon}</div><div class="w-text">${wText}</div></div>
                        <div class="w-stats">
                            <div class="temp-line"><div class="label-box hi-label">HI</div><div id="hi-${i}" style="display:flex">${build('d-temp').repeat(3)}</div></div>
                            <div class="temp-line"><div class="label-box lo-label">LO</div><div id="lo-${i}" style="display:flex">${build('d-temp').repeat(3)}</div></div>
                        </div></div></div>`;
                }
                grid.innerHTML = html;

                // AMeDAS Header Draw
                document.getElementById('am-t-header').innerHTML = build('d-upd').repeat(3);
                document.getElementById('am-w-header').innerHTML = build('d-upd').repeat(2);
                
                setTimeout(() => {
                    draw(document.getElementById('am-t-header'), Math.round(sap.temp[0]));
                    draw(document.getElementById('am-w-header'), Math.round(sap.wind[0]));
                    
                    // 今日
                    draw(document.getElementById(`hi-0`), temps[0] || "--");
                    draw(document.getElementById(`lo-0`), temps[1] || "--");
                    // 明日 (修正版インデックス)
                    draw(document.getElementById(`hi-1`), temps[3] || "--");
                    draw(document.getElementById(`lo-1`), temps[2] || "--");
                }, 50);

            } catch(e) { console.error(e); }
        }

        function saveMsg() { localStorage.setItem('vfd_msg', document.getElementById('msg-input').value); document.getElementById('overlay').style.display='none'; initTicker(); }
        function initTicker() {
            const t = document.getElementById('ticker-text');
            t.innerText = localStorage.getItem('vfd_msg') || "SAPPORO INDUSTRIAL VFD SYSTEM // REALTIME MONITORING ACTIVE";
            t.style.animation = `ticker-anim ${(window.innerWidth + t.offsetWidth)/150}s linear infinite`;
        }

        window.onload = () => {
            document.getElementById('date-group').innerHTML = build('d-sm').repeat(2)+'<div class="dot-unit dot-date on"></div>'+build('d-sm').repeat(2)+'<div class="dot-unit dot-date on"></div>'+build('d-sm').repeat(2);
            document.getElementById('time-group').innerHTML = build('d-lg').repeat(2)+'<div class="colon-box"><div class="dot-unit dot-time on"></div><div class="dot-unit dot-time on"></div></div>'+build('d-lg').repeat(2);
            document.getElementById('sec-group').innerHTML = build('d-sm').repeat(2);
            
            setInterval(() => {
                const n = new Date();
                draw(document.getElementById('date-group'), String(n.getFullYear()).slice(-2)+String(n.getMonth()+1).padStart(2,'0')+String(n.getDate()).padStart(2,'0'));
                draw(document.getElementById('time-group'), String(n.getHours()).padStart(2,'0')+String(n.getMinutes()).padStart(2,'0'));
                draw(document.getElementById('sec-group'), String(n.getSeconds()).padStart(2,'0'));
                if(n.getMinutes() % 10 === 3 && n.getSeconds() === 0) updateAll();
            }, 1000);
            updateAll(); initTicker();
        };
    </script>
</body>
</html>5px var(--glow-outer), 0 0 50px rgba(255, 34, 0, 0.4);
            --header-font-size: 3.3vh; 
            --base-ui-size: 2.3vh;
            --border-main: 2px solid #333;
            --section-gap: 7.6px solid #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-weight: normal !important; }
        body { background-color: var(--bg-color); width: 100vw; height: 100vh; overflow: hidden; display: flex; flex-direction: column; font-family: 'DotGothic16', sans-serif; color: #fff; }

        .bezel { background: var(--iron-panel); box-shadow: inset 0 0 40px #000; margin: 4px; position: relative; flex-shrink: 0; }
        .digit { position: relative; flex-shrink: 0; margin-right: 1.2vw; } 
        .seg { position: absolute; background: var(--led-dim-grad); border-radius: 1px; }
        .seg-h { width: 74%; height: 10%; left: 13%; } .seg-v { width: 15%; height: 38%; } 
        .seg-a { top: 2%; } .seg-b { top: 6%; right: 2%; } .seg-c { bottom: 6%; right: 2%; }
        .seg-d { bottom: 2%; } .seg-e { bottom: 6%; left: 2%; } .seg-f { top: 6%; left: 2%; }
        .seg-g { top: 45%; width: 64%; height: 10%; left: 18%; } 
        .on { background: var(--glow-core) !important; box-shadow: var(--discharge); z-index: 2; }
        .dot-unit { background: var(--led-dim-grad); border-radius: 50%; }

        /* TOP SECTION */
        #top-section { height: 40vh; display: flex; align-items: center; justify-content: center; border: 4px solid #151515; }
        .clock-wrapper { display: flex; align-items: flex-end; transform: scale(0.86); } 
        .d-lg { width: 13.9vw; height: 32vh; } .d-sm { width: 3.63vw; height: 12vh; }  
        .dot-date { width: 0.7vw; height: 0.7vw; margin-bottom: 0.5vh; margin-right: 1.2vw; } 
        .dot-time { width: 2.1vw; height: 2.1vw; } 
        .colon-box { display: flex; flex-direction: column; gap: 7vh; margin-bottom: 5vh; padding: 0 1.2vw; }

        /* MID SECTION */
        #mid-section { height: 46vh; display: flex; flex-direction: column; border-top: var(--section-gap); border-bottom: var(--section-gap); margin: 0 4px; }
        .h-row-unified { display: flex; height: 7vh; background: #000; border-bottom: var(--border-main); flex-shrink: 0; }
        .h-25 { width: 25%; font-size: var(--header-font-size); display: flex; align-items: center; justify-content: center; }
        .h-50 { width: 50%; border-left: var(--border-main); border-right: var(--border-main); background: #0a0a0a; display: flex; align-items: center; justify-content: center; font-size: var(--header-font-size); }
        .h-25-right { width: 25%; font-size: var(--header-font-size); display: flex; align-items: center; justify-content: center; }
        
        /* Updated表示 (日付追加版) */
        .upd-label-main { color: var(--glow-main); text-shadow: 0 0 10px var(--glow-outer); margin-right: 0.8vw; }
        .d-upd { width: 1.6vw; height: 3.3vh; margin-right: 0.3vw !important; }
        .colon-upd-box { display: flex; flex-direction: column; gap: 0.8vh; padding: 0 0.3vw; margin-right: 0.3vw; }
        .dot-upd { width: 0.5vh; height: 0.5vh; }
        .hyphen-upd { width: 0.8vw; height: 0.4vh; background: var(--led-dim-grad); margin: 0 0.4vw; align-self: center; }

        .weather-grid { display: grid; grid-template-columns: 1fr 1fr; flex-grow: 1; }
        .card { border-right: var(--border-main); display: flex; flex-direction: column; height: 100%; }
        .card:last-child { border-right: none; }
        
        /* v131.21 Style Temperature UI */
        .w-main-row { height: 25vh; display: flex; align-items: center; border-bottom: var(--border-main); }
        .w-visual { width: 50%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #222; }
        .w-icon { font-size: 7.5vh; margin-bottom: 1.5vh; text-shadow: 0 0 15px var(--glow-main); color: transparent; text-shadow: 0 0 0 white, 0 0 15px var(--glow-main); }
        .w-text { font-size: 2vh; text-align: center; color: #fff; padding: 0 1vw; }
        .w-stats { width: 50%; display: flex; flex-direction: column; gap: 1.5vh; align-items: flex-end; padding-right: 1.5vw; }
        .temp-line { display: flex; align-items: center; }
        .label-box { font-size: var(--base-ui-size); padding: 2px 6px; min-width: 4.5vw; text-align: center; border-radius: 2px; margin-right: 1vw; }
        .hi-label { color: #000; background: var(--glow-main); box-shadow: 0 0 10px var(--glow-outer); } 
        .lo-label { color: #000; background: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5); } 

        .sub-panel { flex-grow: 1; display: flex; flex-direction: column; background: #000; }
        .sub-title { background: #1a1a1a; color: #fff; font-size: 1.4vh; height: 3vh; line-height: 3vh; text-align: center; letter-spacing: 0.6em; border-bottom: 1px solid #333; }
        .sub-content { display: flex; flex-grow: 1; align-items: center; justify-content: space-around; }

        /* ADMIN & TICKER */
        #admin { position: fixed; bottom: 20px; right: 20px; z-index: 100; opacity: 0.1; transition: 0.4s; }
        #admin:hover { opacity: 1; }
        #admin button { background: #000; color: var(--glow-main); border: 2px solid var(--glow-main); padding: 8px 16px; font-family: 'DotGothic16'; cursor: pointer; }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; }
        #editor { background: #111; border: 4px solid #444; padding: 30px; width: 80%; max-width: 600px; }
        input { background: #000; border: 1px solid #333; color: #fff; padding: 10px; width: 100%; margin-bottom: 15px; font-family: 'DotGothic16'; font-size: 20px; }

        #bot-section { height: 12vh; display: flex; align-items: center; border: 4px solid #151515; overflow: hidden; position: relative; }
        .ticker { white-space: nowrap; font-size: 6vh; color: var(--glow-main); line-height: 12vh; text-shadow: 0 0 15px var(--glow-outer); position: absolute; }
        @keyframes ticker-anim { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }

        .d-temp { width: 2.8vw; height: 8vh; }
        .d-sub { width: 2.2vw; height: 5vh; }
    </style>
</head>
<body>

    <div id="top-section" class="bezel">
        <div class="clock-wrapper">
            <div id="date-group" style="display:flex; align-items:flex-end; padding-right:2.0vw;"></div>
            <div id="time-group" style="display:flex; align-items:flex-end;"></div>
            <div id="sec-group" style="display:flex; align-items:flex-end; margin-left:1.5vw;"></div>
        </div>
    </div>

    <div id="mid-section" class="bezel">
        <div class="h-row-unified">
            <div class="h-25">TODAY</div>
            <div class="h-50">
                <span class="upd-label-main">SAPPORO</span>
                <div id="upd-time-vfd" style="display:flex; align-items:center;"></div>
            </div>
            <div class="h-25-right">TOMORROW</div>
        </div>
        <div class="weather-grid" id="weatherGrid"></div>
    </div>

    <div id="bot-section" class="bezel"><div class="ticker" id="ticker-text"></div></div>

    <div id="admin"><button onclick="document.getElementById('overlay').style.display='flex'">EDIT</button></div>
    <div id="overlay">
        <div id="editor">
            <input type="text" id="msg-input" placeholder="TICKER MESSAGE...">
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="document.getElementById('overlay').style.display='none'" style="padding:10px; font-family:'DotGothic16';">CANCEL</button>
                <button onclick="saveMsg()" style="padding:10px; background:var(--glow-main); border:none; color:black; font-family:'DotGothic16';">SAVE</button>
            </div>
        </div>
    </div>

    <script>
        const MAP = {'0':[1,1,1,1,1,1,0],'1':[0,1,1,0,0,0,0],'2':[1,1,0,1,1,0,1],'3':[1,1,1,1,0,0,1],'4':[0,1,1,0,0,1,1],'5':[1,0,1,1,0,1,1],'6':[1,0,1,1,1,1,1],'7':[1,1,1,0,0,0,0],'8':[1,1,1,1,1,1,1],'9':[1,1,1,1,0,1,1],'-':[0,0,0,0,0,0,1],' ':[0,0,0,0,0,0,0]};
        function build(cls) { return `<div class="digit ${cls}">${['a','b','c','d','e','f','g'].map(s=>`<div class="seg seg-${s} ${['a','d','g'].includes(s)?'seg-h':'seg-v'}"></div>`).join('')}</div>`; }
        function draw(parent, str) {
            if (!parent) return;
            const ds = parent.querySelectorAll('.digit');
            const ts = String(str).padStart(ds.length, ' ');
            for(let i=0; i<ds.length; i++) {
                const pat = MAP[ts[i]] || MAP[' '];
                ds[i].querySelectorAll('.seg').forEach((s, idx) => s.classList.toggle('on', !!pat[idx]));
            }
        }

        async function updateAll() {
            try {
                const fRes = await fetch("https://www.jma.go.jp/bosai/forecast/data/forecast/016000.json");
                const fData = await fRes.json();
                const tRes = await fetch("https://www.jma.go.jp/bosai/amedas/data/latest_time.txt");
                const tStr = await tRes.text();
                const aKey = tStr.replace(/[-T:Z+]/g, '').substring(0, 12) + "00";
                const aRes = await fetch(`https://www.jma.go.jp/bosai/amedas/data/map/${aKey}.json`);
                const aData = await aRes.json();
                const sap = aData["14163"];

                const grid = document.getElementById('weatherGrid');
                let html = "";
                const temps = fData[0].timeSeries[2].areas[0].temps; // [今日朝, 今日日中, 明日朝, 明日日中]

                for(let i=0; i<2; i++){
                    const area = fData[0].timeSeries[0].areas[0];
                    const wText = area.weathers[i];
                    const icon = wText.includes('雪') ? '❄️' : wText.includes('雨') ? '☔' : wText.includes('曇') ? '☁️' : '☀️';
                    
                    // v131.21 UI Structure
                    let hiT = temps[i*2]; let loT = temps[i*2+1];
                    let subPart = "";
                    if(i===0) {
                        subPart = `<div class="sub-panel"><div class="sub-title">AMeDAS (SAPPORO)</div><div class="sub-content">
                            <div style="display:flex;flex-direction:column;align-items:center;"><span style="font-size:1.4vh;color:#888;">TEMP</span><div style="display:flex;align-items:flex-end;"><div id="am-t" style="display:flex">${build('d-sub').repeat(3)}</div><span style="font-size:1.6vh;margin-left:0.4vw;">℃</span></div></div>
                            <div style="display:flex;flex-direction:column;align-items:center;"><span style="font-size:1.4vh;color:#888;">WIND</span><div style="display:flex;align-items:flex-end;"><div id="am-w" style="display:flex">${build('d-sub').repeat(2)}</div><span style="font-size:1.6vh;margin-left:0.4vw;">m/s</span></div></div>
                        </div></div>`;
                    } else {
                        subPart = `<div class="sub-panel"><div class="sub-title">PRECIP PROB</div><div class="sub-content">
                            ${[0,1,2,3].map(j=>`<div style="display:flex;flex-direction:column;align-items:center;"><span style="font-size:1.4vh;color:#888;">${j*6}h</span><div id="p-${j}" style="display:flex">${build('d-sub').repeat(2)}</div></div>`).join('')}
                        </div></div>`;
                    }

                    html += `<div class="card"><div class="w-main-row"><div class="w-visual"><div class="w-icon">${icon}</div><div class="w-text">${wText}</div></div>
                        <div class="w-stats">
                            <div class="temp-line"><div class="label-box hi-label">HI</div><div id="hi-${i}" style="display:flex">${build('d-temp').repeat(3)}</div></div>
                            <div class="temp-line"><div class="label-box lo-label">LO</div><div id="lo-${i}" style="display:flex">${build('d-temp').repeat(3)}</div></div>
                        </div></div>${subPart}</div>`;
                }
                grid.innerHTML = html;

                setTimeout(() => {
                    const dt = new Date(tStr);
                    const updStr = (dt.getMonth()+1).toString().padStart(2,'0') + dt.getDate().toString().padStart(2,'0') + dt.getHours().toString().padStart(2,'0') + dt.getMinutes().toString().padStart(2,'0');
                    draw(document.getElementById('upd-time-vfd'), updStr);
                    for(let i=0; i<2; i++) {
                        draw(document.getElementById(`hi-${i}`), temps[i*2] || "--");
                        draw(document.getElementById(`lo-${i}`), temps[i*2+1] || "--");
                    }
                    draw(document.getElementById('am-t'), Math.round(sap.temp[0]));
                    draw(document.getElementById('am-w'), Math.round(sap.wind[0]));
                    const pops = fData[0].timeSeries[1].areas[0].pops;
                    [0,1,2,3].forEach(j => draw(document.getElementById(`p-${j}`), pops[pops.length-4+j] || "--"));
                }, 50);
            } catch(e) { console.error(e); }
        }

        function saveMsg() { localStorage.setItem('vfd_msg', document.getElementById('msg-input').value); document.getElementById('overlay').style.display='none'; initTicker(); }
        function initTicker() {
            const t = document.getElementById('ticker-text');
            t.innerText = localStorage.getItem('vfd_msg') || "SAPPORO INDUSTRIAL VFD SYSTEM ACTIVE // STANDBY FOR UPDATES";
            t.style.animation = `ticker-anim ${(window.innerWidth + t.offsetWidth)/150}s linear infinite`;
        }

        window.onload = () => {
            document.getElementById('date-group').innerHTML = build('d-sm').repeat(2)+'<div class="dot-unit dot-date on"></div>'+build('d-sm').repeat(2)+'<div class="dot-unit dot-date on"></div>'+build('d-sm').repeat(2);
            document.getElementById('time-group').innerHTML = build('d-lg').repeat(2)+'<div class="colon-box"><div class="dot-unit dot-time on"></div><div class="dot-unit dot-time on"></div></div>'+build('d-lg').repeat(2);
            document.getElementById('sec-group').innerHTML = build('d-sm').repeat(2);
            document.getElementById('upd-time-vfd').innerHTML = build('d-upd').repeat(2) + '<div class="hyphen-upd on"></div>' + build('d-upd').repeat(2) + '<div style="width:1.2vw"></div>' + build('d-upd').repeat(2) + '<div class="colon-upd-box"><div class="dot-unit dot-upd on"></div><div class="dot-unit dot-upd on"></div></div>' + build('d-upd').repeat(2);
            
            setInterval(() => {
                const n = new Date();
                draw(document.getElementById('date-group'), String(n.getFullYear()).slice(-2)+String(n.getMonth()+1).padStart(2,'0')+String(n.getDate()).padStart(2,'0'));
                draw(document.getElementById('time-group'), String(n.getHours()).padStart(2,'0')+String(n.getMinutes()).padStart(2,'0'));
                draw(document.getElementById('sec-group'), String(n.getSeconds()).padStart(2,'0'));
                if(n.getMinutes() % 10 === 3 && n.getSeconds() === 0) updateAll();
            }, 1000);
            updateAll(); initTicker();
        };
    </script>
</body>
</html>

